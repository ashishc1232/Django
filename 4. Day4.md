# Django Configuration Deep Dive: Environment Variables & Database

I'll explain **everything** about configuration, environment variables, and database setup for complete beginners.

---

## 1. Why Environment Variables? ðŸ¤”

**Problem:**
```python
# settings.py
SECRET_KEY = 'django-insecure-my-secret-key-12345'
DATABASE_PASSWORD = 'mypassword123'
```

âŒ **Bad because:**
- If you upload to GitHub, everyone sees your secrets
- Different settings for development vs production
- Hard to change settings without editing code

âœ… **Solution: Environment Variables**
- Store secrets outside your code
- Different values for different environments
- Easy to change without touching code

---

## 2. Setting Up Environment Variables

### **Step 1: Install python-decouple**

```bash
pip install python-decouple
```

**What is python-decouple?**
- A package that reads environment variables
- Makes configuration easy and secure

---

### **Step 2: Create `.env` File**

In your **project root** (same level as `manage.py`), create a file named `.env`:

```
my_django_project/
â”œâ”€â”€ .env              â† Create this file
â”œâ”€â”€ manage.py
â”œâ”€â”€ myproject/
â””â”€â”€ myapp/
```

**What is `.env` file?**
- A simple text file
- Stores key-value pairs
- **NEVER commit this to Git**

**.env file content:**
```env
# Django Settings
SECRET_KEY=django-insecure-your-secret-key-here-xyz123
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database Settings
DB_ENGINE=django.db.backends.postgresql
DB_NAME=mydatabase
DB_USER=myuser
DB_PASSWORD=mypassword123
DB_HOST=localhost
DB_PORT=5432

# Email Settings
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# AWS Settings (for file storage)
AWS_ACCESS_KEY_ID=your-aws-key
AWS_SECRET_ACCESS_KEY=your-aws-secret

# Other Settings
TIME_ZONE=Asia/Kolkata
LANGUAGE_CODE=en-in
```

**Important Rules for .env:**
- No spaces around `=`
- No quotes needed (usually)
- One setting per line
- Comments start with `#`

---

### **Step 3: Update settings.py**

Replace hardcoded values with environment variables:

```python
# myproject/settings.py

from pathlib import Path
from decouple import config, Csv

# Build paths inside the project
BASE_DIR = Path(__file__).resolve().parent.parent

# SECRET KEY - Read from .env file
SECRET_KEY = config('SECRET_KEY')

# DEBUG - Convert string to boolean
DEBUG = config('DEBUG', default=False, cast=bool)

# ALLOWED HOSTS - Convert comma-separated string to list
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='', cast=Csv())

# Example: ALLOWED_HOSTS=localhost,127.0.0.1,example.com
# Becomes: ['localhost', '127.0.0.1', 'example.com']
```

**Explanation of each line:**

```python
SECRET_KEY = config('SECRET_KEY')
# Reads SECRET_KEY from .env file
# If not found, raises an error
```

```python
DEBUG = config('DEBUG', default=False, cast=bool)
# Reads DEBUG from .env
# If not found, uses False
# cast=bool converts string 'True'/'False' to boolean
```

```python
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='', cast=Csv())
# Reads comma-separated values
# Converts to Python list
# Example: 'a,b,c' becomes ['a', 'b', 'c']
```

---

### **Step 4: Create `.env.example` File**

Create a template for others (without real secrets):

```env
# .env.example
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
DB_ENGINE=django.db.backends.postgresql
DB_NAME=your-db-name
DB_USER=your-db-user
DB_PASSWORD=your-db-password
DB_HOST=localhost
DB_PORT=5432
```

**Purpose:**
- Shows what variables are needed
- Safe to commit to Git
- Others copy this to create their own `.env`

---

### **Step 5: Update .gitignore**

Create/edit `.gitignore` file in project root:

```
# .gitignore

# Python
*.pyc
__pycache__/
*.py[cod]
*$py.class

# Django
*.log
db.sqlite3
db.sqlite3-journal
/media
/staticfiles

# Environment variables
.env           â† Important!
.venv
venv/
ENV/

# IDEs
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db
```

---

## 3. Database Configuration in Detail

### **Option 1: SQLite (Default - Simple)**

**When to use:**
- Small projects
- Learning/Development
- Single-user applications

**settings.py:**
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

**Explanation:**
- `ENGINE`: Type of database
- `NAME`: File path where database is stored
- `BASE_DIR / 'db.sqlite3'` means the file is in project root

**Pros:**
âœ… No installation needed
âœ… Easy to setup
âœ… Good for learning

**Cons:**
âŒ Not good for production
âŒ Slow with many users
âŒ Limited features

---

### **Option 2: PostgreSQL (Recommended for Production)**

**When to use:**
- Real-world applications
- Multiple users
- Production websites

#### **Step 1: Install PostgreSQL**

**Windows:**
1. Download from [postgresql.org](https://www.postgresql.org/download/)
2. Install with default settings
3. Remember the password you set

**Mac:**
```bash
brew install postgresql
brew services start postgresql
```

**Linux (Ubuntu):**
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
```

---

#### **Step 2: Create Database**

Open PostgreSQL command line:

**Windows:** Search "psql" or "SQL Shell"

**Mac/Linux:**
```bash
sudo -u postgres psql
```

**In psql, run these commands:**
```sql
-- Create a new database
CREATE DATABASE mydatabase;

-- Create a new user
CREATE USER myuser WITH PASSWORD 'mypassword123';

-- Give user permissions
ALTER ROLE myuser SET client_encoding TO 'utf8';
ALTER ROLE myuser SET default_transaction_isolation TO 'read committed';
ALTER ROLE myuser SET timezone TO 'UTC';

-- Grant all privileges
GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser;

-- Exit
\q
```

**Explanation line by line:**

```sql
CREATE DATABASE mydatabase;
-- Creates a new database named 'mydatabase'
```

```sql
CREATE USER myuser WITH PASSWORD 'mypassword123';
-- Creates a new user that Django will use to connect
```

```sql
ALTER ROLE myuser SET client_encoding TO 'utf8';
-- Sets character encoding (supports all languages)
```

```sql
ALTER ROLE myuser SET default_transaction_isolation TO 'read committed';
-- Sets how database handles concurrent requests
```

```sql
GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser;
-- Gives the user full access to the database
```

---

#### **Step 3: Install psycopg2 (PostgreSQL adapter)**

```bash
pip install psycopg2-binary
```

**What is psycopg2?**
- Allows Django to talk to PostgreSQL
- Like a translator between Django and PostgreSQL

---

#### **Step 4: Configure Django**

**Add to .env file:**
```env
DB_ENGINE=django.db.backends.postgresql
DB_NAME=mydatabase
DB_USER=myuser
DB_PASSWORD=mypassword123
DB_HOST=localhost
DB_PORT=5432
```

**Update settings.py:**
```python
from decouple import config

DATABASES = {
    'default': {
        'ENGINE': config('DB_ENGINE'),
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='5432', cast=int),
    }
}
```

**Explanation:**
- `ENGINE`: Database backend (PostgreSQL)
- `NAME`: Database name (mydatabase)
- `USER`: Username (myuser)
- `PASSWORD`: User's password
- `HOST`: Server location (localhost = same computer)
- `PORT`: PostgreSQL port (5432 is default)

---

### **Option 3: MySQL/MariaDB**

#### **Step 1: Install MySQL**

**Windows:** Download from [mysql.com](https://dev.mysql.com/downloads/installer/)

**Mac:**
```bash
brew install mysql
brew services start mysql
```

**Linux:**
```bash
sudo apt install mysql-server
sudo systemctl start mysql
```

---

#### **Step 2: Create Database**

```bash
mysql -u root -p
```

**In MySQL:**
```sql
CREATE DATABASE mydatabase CHARACTER SET utf8mb4;
CREATE USER 'myuser'@'localhost' IDENTIFIED BY 'mypassword123';
GRANT ALL PRIVILEGES ON mydatabase.* TO 'myuser'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

---

#### **Step 3: Install MySQL adapter**

```bash
pip install mysqlclient
```

---

#### **Step 4: Configure Django**

**.env:**
```env
DB_ENGINE=django.db.backends.mysql
DB_NAME=mydatabase
DB_USER=myuser
DB_PASSWORD=mypassword123
DB_HOST=localhost
DB_PORT=3306
```

**settings.py:**
```python
DATABASES = {
    'default': {
        'ENGINE': config('DB_ENGINE'),
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='3306', cast=int),
        'OPTIONS': {
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
            'charset': 'utf8mb4',
        },
    }
}
```

---

## 4. Advanced Database Configurations

### **Multiple Databases**

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'main_db',
        'USER': 'user1',
        'PASSWORD': 'pass1',
        'HOST': 'localhost',
        'PORT': '5432',
    },
    'analytics': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'analytics_db',
        'USER': 'user2',
        'PASSWORD': 'pass2',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

**Use in models:**
```python
# Save to specific database
user = User.objects.using('analytics').create(username='john')

# Query specific database
users = User.objects.using('analytics').all()
```

---

### **Connection Pooling (Advanced)**

For better performance with PostgreSQL:

```bash
pip install django-db-connection-pool
```

**settings.py:**
```python
DATABASES = {
    'default': {
        'ENGINE': 'dj_db_conn_pool.backends.postgresql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT'),
        'POOL_OPTIONS': {
            'POOL_SIZE': 10,
            'MAX_OVERFLOW': 10,
        }
    }
}
```

---

## 5. Complete Configuration Example---

## 6. .env File Templates

### **Development .env:**
```env
# Development Settings
SECRET_KEY=django-insecure-dev-key-xyz123abc
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# SQLite Database (Simple)
DB_ENGINE=django.db.backends.sqlite3
DB_NAME=db.sqlite3

# Localization
TIME_ZONE=Asia/Kolkata
LANGUAGE_CODE=en-in

# Email (Console - prints to terminal)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
```

### **Production .env:**
```env
# Production Settings
SECRET_KEY=your-super-secret-production-key-change-this
DEBUG=False
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com

# PostgreSQL Database
DB_ENGINE=django.db.backends.postgresql
DB_NAME=prod_database
DB_USER=prod_user
DB_PASSWORD=strong-password-here
DB_HOST=db.yourdomain.com
DB_PORT=5432

# Localization
TIME_ZONE=Asia/Kolkata
LANGUAGE_CODE=en-in

# Email (SMTP)
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-specific-password
DEFAULT_FROM_EMAIL=noreply@yourdomain.com
```

---

## 7. Testing Database Connection

Create this test script to verify database connection:

```python
# test_db.py (in project root)

import os
import django

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproject.settings')
django.setup()

from django.db import connection

def test_database_connection():
    try:
        with connection.cursor() as cursor:
            cursor.execute("SELECT 1")
            print("âœ… Database connection successful!")
            print(f"Database: {connection.settings_dict['NAME']}")
            print(f"User: {connection.settings_dict['USER']}")
            print(f"Host: {connection.settings_dict['HOST']}")
            print(f"Port: {connection.settings_dict['PORT']}")
    except Exception as e:
        print(f"âŒ Database connection failed: {e}")

if __name__ == '__main__':
    test_database_connection()
```

**Run it:**
```bash
python test_db.py
```

---

## 8. Common Issues & Solutions

### **Issue 1: Module 'decouple' not found**
```bash
pip install python-decouple
```

### **Issue 2: Database connection refused**
- Check if PostgreSQL/MySQL is running
- Verify username/password in .env
- Check HOST and PORT values

### **Issue 3: .env file not being read**
- Make sure .env is in the same folder as manage.py
- Check file name (no spaces, exactly `.env`)
- Try absolute path:
```python
from decouple import Config, RepositoryEnv
DOTENV_FILE = BASE_DIR / '.env'
config = Config(RepositoryEnv(DOTENV_FILE))
```

### **Issue 4: SECRET_KEY error**
Generate a new secret key:
```python
from django.core.management.utils import get_random_secret_key
print(get_random_secret_key())
```

---

## 9. Quick Setup Commands

```bash
# 1. Install dependencies
pip install python-decouple psycopg2-binary

# 2. Create .env file
echo "SECRET_KEY=your-key-here" > .env
echo "DEBUG=True" >> .env

# 3. Generate secret key
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"

# 4. Test database
python manage.py check --database default

# 5. Run migrations
python manage.py migrate

# 6. Create superuser
python manage.py createsuperuser

# 7. Run server
python manage.py runserver
```

---

## 10. Summary Checklist

âœ… Install `python-decouple`  
âœ… Create `.env` file in project root  
âœ… Add `.env` to `.gitignore`  
âœ… Create `.env.example` template  
âœ… Update `settings.py` to use `config()`  
âœ… Choose database (SQLite/PostgreSQL/MySQL)  
âœ… Install database adapter  
âœ… Configure database settings  
âœ… Test database connection  
âœ… Run migrations  

---

Would you like me to explain:
1. How to deploy with these configurations?
2. How to handle different environments (dev/staging/production)?
3. Advanced security configurations?
